# 项目搭建——前端工作流

## 参考

* [使用 husky、commitlint 和 lint-staged 来构建你的前端工作流（vue、react、dva）](https://juejin.cn/post/6844904048525574152)

## monorepo——lerna

### 1. 安装

```bash
npm i -D lerna
```

### 2. 配置

```bash
npx lerna init --independent
```

### 3. 修改lerna.json

```json
{
  "packages": ["packages/*"],
  "version": "independent",
  "npmClient": "npm",
  "command": {
    "publish": {
      "conventionalCommits": true,
      "message": "chore(release): publish %s"
    }
  }
}
```

## typescript

### 安装

```bash
npm i -D typescript
```

## prettier eslint

### 1. 安装

```bash
npm i -D prettier eslint
```

### 2. 配置prettier

#### 2.1 .prettierrc

```json
{
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "singleQuote": true,
  "semi": true,
  "trailingComma": "all",
  "arrowParens": "avoid",
  "bracketSpacing": true,
  "endOfLine": "auto"
}
```

#### 2.2 .prettierignore

```text
node_modules
dist
```

### 3. 配置eslint

#### 3.1 安装及初始化

```bash
npm i -D eslint
# 通过引导的方式来安装配置eslint，这里要注意一点，如果使用typescript，请先安装typescript：`npm i -D typescript`
npx eslint --init
```

对于typescript+vue的项目，相关的插件都会一并安装好，包括如下：

* @typescript-eslint/eslint-plugin
* @typescript-eslint/parser
* eslint-config-airbnb-base
* eslint-plugin-import
* eslint-plugin-vue

#### 3.2 配置插件

```bash
npm i -D eslint-config-prettier eslint-plugin-prettier-vue  eslint-import-resolver-typescript 
```

#### 3.3 示例

```javascript
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true,
  },
  extends: [
    'airbnb-base',
    'plugin:@typescript-eslint/recommended',
    'plugin:vue/vue3-recommended',
    'plugin:prettier-vue/recommended',
    'prettier/@typescript-eslint',
    'prettier/vue',
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    ecmaVersion: 12,
    parser: '@typescript-eslint/parser',
    sourceType: 'module',
    ecmaFeature: {
      jsx: true,
    },
  },
  plugins: ['vue', '@typescript-eslint', 'import'],
  settings: {
    'import/parsers': {
      '@typescript-eslint/parser': ['.ts', '.tsx'],
    },
    'import/resolver': {
      typescript: {
        project: 'packages/*/tsconfig.json',
      },
    },
  },
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'prettier-vue/prettier': 'error',
    'import/no-unresolved': 'error',
    'import/extensions': [
      'error',
      'ignorePackages',
      {
        ts: 'never',
        tsx: 'never',
      },
    ],
  },
};
```

## commitizen

### 1. 安装

```bash
npm i -D commitizen
```

### 2. 配置

#### 2.1 非lerna项目

```bash
npx commitizen init cz-conventional-changelog --save-dev --save-exact
```

#### 2.2 lerna 项目

```bash
npx commitizen init cz-lerna-changelog --save-dev --save-exact
```

#### 3. 添加script

package.json的script中添加：

```text
"commit": "git cz",
```

后续直接使用`npm run commit`来提交信息

## commitlint husky lint-staged

### 1. 安装

```bash
npm install -D @commitlint/cli @commitlint/config-conventional husky lint-staged
```

### 2. 配置

#### 2.1 配置commitlint

```bash
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

#### 2.2 配置husky lint-staged

lint-staged中的文件类型根据具体项目进行修改

```text
"husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS",
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{ts,vue}": [
      "eslint --fix",
      "prettier --write",
      "git add -f"
    ]
  },
```
